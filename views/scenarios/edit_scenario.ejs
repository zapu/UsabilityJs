<%
	var pageTitle = scenario ? ("Editing scenario " + scenario.name) : "New scenario";
%>

<%-render("views/header.ejs", {PageTitle: pageTitle})%>
<%-render("views/nav.ejs")%>

<script type="text/javascript" src="/static/jquery-1.6.2.min.js"></script>
<script type="text/javascript" src="/static/jquery-ui-1.8.16.custom.min.js"></script>
<script type="text/javascript">
	$(document).ready(function(){
		$("#tasklist").sortable();

		$("a.derpLink").click(function(){
			$("#tasklist").children().each(function(index){
				console.log($(this).children('input')[0].value);
			});
		});

		$("a.addTaskLink").click(function(){
			$("#tasklist").append(generateTaskHTML());

			rebindTaskListHandlers();
		});

		rebindTaskListHandlers();
	});

	function rebindTaskListHandlers()
	{
		$("#tasklist a.removeLink").click(function(){
			var element = $(this).parent();
			element.hide("slow", function(){
				element.remove();
			});
		});

		$("#tasklist a.addLink").click(function(){
			$(this).parent().after(generateTaskHTML());

			rebindTaskListHandlers();
		});
	}

	function generateTaskHTML()
	{
		return "<li>↕" +
			"<input type=\"text\"/>" +
			"× <a href=\"#\" class=\"removeLink\">Remove</a> | + <a href=\"#\" class=\"addLink\">Add</a>" +
		"</li>";
	}
</script>

<div class="content-div">
	<h1>Editing scenario</h1>
	<form>

	<% if(scenario != null) { %>
		<input type="hidden" name="scenario_id" value="<%=scenario._id%>"/>
	<% } %>

	<p>
		Scenario name: <input type="text" name="scenario_name" value="<%=scenario ? scenario.name : ""%>"/>
	</p>
	<p>
		Starting URL: <input type="text" name="starting_url" value="<%=scenario ? scenario.address : ""%>"/>
	</p>
	<p>
		Description:<br/>
		<textarea name="description"><%=scenario ? scenario.description : ""%></textarea>
	</p>

	<h2>Tasks</h2>
	<ol id="tasklist">
		<% if(scenario != null) { %>
			<% scenario.tasks.forEach(function(task) { %>
				<li>
					↕
					<input type="text" value="<%=task%>"/>
					× <a href="#" class="removeLink">Remove</a> | + <a href="#" class="addLink">Add</a>
				</li>
			<% }); %>
		<% }%>
	</ol>

	</form>

	<a href="#" class="addTaskLink">+ Add new task</a>

	<a href="#" class="derpLink">console log</a>
</div>

<div class="content-div">
	<h2>Manage</h2>
	<ul>
		<li>Remove Scenario</li>
		<li>Edit Scenario</li>
	</ul>
</div>

<%-render("views/footer.ejs")%>